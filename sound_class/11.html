<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聲道設定與 PolyWAV｜Channel Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: manipulation;
        }

        .digital-font {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar for track list */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Headphones = () => (
            <Icon><path d="M3 14v-3a9 9 0 0 1 18 0v3" /><path d="M3 19a2.34 2.34 0 0 0 .56 1.68l1.68 1.68A2 2 0 0 0 6.68 23h1.64A2 2 0 0 0 10 21v-3a2 2 0 0 0-2-2H4.5" /><path d="M19.5 16H16a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1.68a2 2 0 0 0 1.41-.59l1.68-1.68A2.34 2.34 0 0 0 21 19v-3" /></Icon>
        );
        const Play = ({ className }) => (
            <Icon className={className}><polygon points="5 3 19 12 5 21 5 3" /></Icon>
        );
        const Pause = ({ className }) => (
            <Icon className={className}><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></Icon>
        );
        const ArrowLeft = () => (
            <Icon><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></Icon>
        );
        const Layers = ({ className }) => (
            <Icon className={className}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></Icon>
        );


        // --- Component: Mono vs Stereo Player ---
        const MonoStereoDemo = () => {
            const [activeSource, setActiveSource] = useState(null); // 'left' or 'right'
            const [mixMode, setMixMode] = useState(null); // 'stereo' (wrong) or 'mono' (correct)
            const audioRef = useRef(null);

            // This ref tracks which actual file is playing: source raw or mixed result
            const currentPlaying = useRef(null);

            const sources = [
                { id: 'left', label: '原始素材 (L Only)', file: 'sound/left.mp3', color: 'text-blue-400', border: 'border-blue-500' },
                { id: 'right', label: '原始素材 (R Only)', file: 'sound/right.mp3', color: 'text-red-400', border: 'border-red-500' }
            ];

            const outputs = [
                { id: 'stereo', label: '混成 Stereo (錯誤)', file: 'sound/stereo.mp3', desc: '聲音偏左或偏右(聽感不適)', color: 'text-purple-400', border: 'border-purple-500', icon: <span className="text-xl">❌</span> },
                { id: 'mono', label: '混成 Mono (正確)', file: 'sound/mono.mp3', desc: '聲音置中 (清晰有力)', color: 'text-green-400', border: 'border-green-500', icon: <span className="text-xl">✅</span> }
            ];

            const playAudio = (file, type, id) => {
                if (currentPlaying.current === id) {
                    audioRef.current.pause();
                    currentPlaying.current = null;
                    if (type === 'source') setActiveSource(null);
                    if (type === 'output') setMixMode(null);
                } else {
                    // Reset other states
                    setActiveSource(type === 'source' ? id : null);
                    setMixMode(type === 'output' ? id : null);

                    audioRef.current.src = file;
                    audioRef.current.play();
                    currentPlaying.current = id;
                }
            };

            return (
                <div className="bg-slate-900 rounded-2xl border border-slate-700 overflow-hidden relative">
                    <audio ref={audioRef} onEnded={() => {
                        setActiveSource(null);
                        setMixMode(null);
                        currentPlaying.current = null;
                    }} />

                    <div className="p-8 grid lg:grid-cols-11 gap-4 items-stretch">

                        {/* 1. Source Material */}
                        <div className="lg:col-span-4 space-y-4">
                            <div className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 text-center">Step 1: 監聽原始素材 (Source)</div>
                            <div className="bg-slate-950/50 p-4 rounded-xl border border-slate-800 h-full flex flex-col justify-center gap-4">
                                {sources.map(src => (
                                    <button
                                        key={src.id}
                                        onClick={() => playAudio(src.file, 'source', src.id)}
                                        className={`w-full p-4 rounded-lg border transition-all duration-200 flex items-center justify-between group
                                            ${activeSource === src.id ? `${src.border} bg-slate-800 shadow-lg` : 'border-slate-700 hover:border-slate-600'}`}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`w-2 h-2 rounded-full ${activeSource === src.id ? 'bg-current animate-ping' : 'bg-slate-600'} ${src.color}`}></div>
                                            <span className={`font-bold text-sm ${src.color}`}>{src.label}</span>
                                        </div>
                                        {activeSource === src.id ? <Pause className="w-4 h-4" /> : <Play className="w-4 h-4 text-slate-600" />}
                                    </button>
                                ))}
                                <p className="text-xs text-slate-500 text-center mt-2 leading-relaxed">
                                    這是個別領夾麥克風錄進來的樣子，<br />一支在男生身上，一支在女生身上
                                </p>
                            </div>
                        </div>

                        {/* Arrow */}
                        <div className="lg:col-span-1 flex items-center justify-center py-4 lg:py-0">
                            <div className="bg-slate-800 rounded-full p-2 text-slate-500">
                                <Icon className="rotate-90 lg:rotate-0"><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></Icon>
                            </div>
                        </div>

                        {/* 2. Mixing Output */}
                        <div className="lg:col-span-6 space-y-4">
                            <div className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 text-center">Step 2: 混音輸出結果 (Output Mix)</div>
                            <div className="bg-slate-950/50 p-4 rounded-xl border border-slate-800 h-full flex flex-col justify-center gap-4">
                                {outputs.map(out => (
                                    <button
                                        key={out.id}
                                        onClick={() => playAudio(out.file, 'output', out.id)}
                                        className={`w-full p-4 rounded-lg border-2 transition-all duration-200 flex items-center justify-between relative overflow-hidden
                                            ${mixMode === out.id ? `${out.border} bg-slate-800 shadow-lg` : 'border-slate-700 hover:bg-slate-900'}`}
                                    >
                                        <div className="flex items-center gap-4 z-10">
                                            {out.icon}
                                            <div className="text-left">
                                                <div className={`font-bold ${out.color}`}>{out.label}</div>
                                                <div className="text-xs text-slate-400">{out.desc}</div>
                                            </div>
                                        </div>
                                        <div className="z-10">
                                            {mixMode === out.id ? <Pause className={out.color} /> : <Play className="text-slate-600" />}
                                        </div>

                                        {/* Background Progress/Active Indicator */}
                                        {mixMode === out.id && (
                                            <div className={`absolute inset-0 opacity-10 ${out.color.replace('text', 'bg')}`}></div>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Visualizer Section (Bottom) */}
                    <div className="bg-black/30 p-6 border-t border-slate-800 flex justify-center">
                        <div className="relative w-48 h-48 opacity-80">
                            {/* Head Outline */}
                            <svg viewBox="0 0 200 200" className="w-full h-full text-slate-700">
                                <path fill="none" stroke="currentColor" strokeWidth="8" d="M30,120 v-40 a70,70 0 0,1 140,0 v40" strokeLinecap="round" />

                                {/* Left Ear */}
                                <rect x="10" y="110" width="30" height="50" rx="8"
                                    className={`transition-all duration-200 ${activeSource === 'left' ? 'fill-blue-500 drop-shadow-[0_0_10px_blue]'
                                        : activeSource === 'right' ? 'fill-red-500 drop-shadow-[0_0_10px_red]'
                                            : mixMode === 'stereo' ? 'fill-blue-500 drop-shadow-[0_0_10px_blue]'
                                                : mixMode === 'mono' ? 'fill-green-500 drop-shadow-[0_0_10px_green]'
                                                    : 'fill-slate-800'}`}
                                />

                                {/* Right Ear */}
                                <rect x="160" y="110" width="30" height="50" rx="8"
                                    className={`transition-all duration-200 ${activeSource === 'left' ? 'fill-blue-500 drop-shadow-[0_0_10px_blue]'
                                        : activeSource === 'right' ? 'fill-red-500 drop-shadow-[0_0_10px_red]'
                                            : mixMode === 'stereo' ? 'fill-red-500 drop-shadow-[0_0_10px_red]'
                                                : mixMode === 'mono' ? 'fill-green-500 drop-shadow-[0_0_10px_green]'
                                                    : 'fill-slate-800'}`}
                                />

                                {/* Brain/Center */}
                                <circle cx="100" cy="100" r="10"
                                    className={`transition-all duration-300 ${mixMode === 'mono' ? 'fill-green-400 animate-pulse' : 'fill-slate-800'}`}
                                />
                            </svg>

                            {/* Status Text */}
                            <div className="absolute bottom-0 left-0 right-0 text-center">
                                <span className={`text-xs font-bold px-2 py-1 rounded 
                                    ${mixMode === 'mono' ? 'bg-green-500/20 text-green-400'
                                        : mixMode === 'stereo' ? 'bg-purple-500/20 text-purple-400'
                                            : activeSource ? 'bg-blue-500/20 text-blue-300'
                                                : 'text-slate-600'}`}>
                                    {mixMode === 'mono' ? 'CENTERED (Stable)'
                                        : mixMode === 'stereo' ? 'UNBALANCED (Split)'
                                            : activeSource ? 'ONE SIDE (Raw)'
                                                : 'NO SIGNAL'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Component: PolyWAV Player ---
        const PolyWavDemo = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [soloTrack, setSoloTrack] = useState(null); // null = all playing

            const tracks = [
                { id: 1, name: 'Boom Mic', file: 'sound/ch1-boom.mp3', color: 'text-green-400', bg: 'bg-green-500' },
                { id: 2, name: 'Lavalier (Girl)', file: 'sound/ch2_girl.mp3', color: 'text-pink-400', bg: 'bg-pink-500' },
                { id: 3, name: 'Lavalier (Boy)', file: 'sound/ch3_boy.mp3', color: 'text-blue-400', bg: 'bg-blue-500' },
            ];

            const audioRefs = useRef(tracks.map(() => new Audio()));

            // Initialize Audio Sources
            useEffect(() => {
                tracks.forEach((track, index) => {
                    audioRefs.current[index].src = track.file;
                    audioRefs.current[index].loop = true;
                });

                // Cleanup
                return () => {
                    audioRefs.current.forEach(audio => {
                        audio.pause();
                        audio.src = "";
                    });
                };
            }, []);

            // Handle Play/Pause
            const togglePlay = () => {
                if (isPlaying) {
                    audioRefs.current.forEach(audio => audio.pause());
                } else {
                    audioRefs.current.forEach(audio => {
                        // Attempt to sync start? Simple play is usually "close enough" for this demo
                        // For better sync we'd wait for all to be ready, but let's assume loaded.
                        audio.play().catch(e => console.error("Play failed", e));
                    });
                }
                setIsPlaying(!isPlaying);
            };

            // Handle Solo Logic (Muting others)
            useEffect(() => {
                audioRefs.current.forEach((audio, index) => {
                    const trackId = tracks[index].id;
                    if (soloTrack === null) {
                        audio.volume = 1; // All on
                    } else {
                        audio.volume = (soloTrack === trackId) ? 1 : 0; // Only solo on
                    }
                });
            }, [soloTrack]);

            return (
                <div className="bg-slate-900 rounded-2xl border border-slate-700 overflow-hidden">
                    <div className="p-6 border-b border-slate-800 flex justify-between items-center bg-gradient-to-r from-slate-900 to-slate-800">
                        <div>
                            <h3 className="text-xl font-bold text-white flex items-center gap-2">
                                <Layers className="text-yellow-500" /> PolyWAV (多軌檔案)
                            </h3>
                            <p className="text-xs text-slate-400 mt-1">單一檔案與多個頻道 (One File, Multiple Channels)</p>
                        </div>
                        <button
                            onClick={togglePlay}
                            className={`w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-lg active:scale-95 ${isPlaying ? 'bg-yellow-500 text-black hover:bg-yellow-400' : 'bg-slate-700 text-white hover:bg-slate-600'}`}
                        >
                            {isPlaying ? <Pause /> : <Play />}
                        </button>
                    </div>

                    <div className="p-2 space-y-2">
                        {tracks.map((track) => (
                            <div key={track.id} className="bg-slate-950 p-4 rounded-lg border border-slate-800 flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className={`w-8 h-8 rounded flex items-center justify-center font-bold text-slate-900 ${track.bg}`}>
                                        {track.id}
                                    </div>
                                    <div>
                                        <div className={`font-bold ${track.color}`}>{track.name}</div>
                                        <div className="text-xs text-slate-500 uppercase tracking-wider">Channel {track.id}</div>
                                    </div>
                                </div>

                                {/* Solo Button */}
                                <button
                                    onClick={() => setSoloTrack(soloTrack === track.id ? null : track.id)}
                                    className={`px-4 py-1 rounded text-xs font-bold border transition-all
                                        ${soloTrack === track.id
                                            ? 'bg-yellow-500 text-black border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.5)]'
                                            : 'bg-transparent text-slate-500 border-slate-700 hover:border-slate-500 hover:text-slate-300'}`}
                                >
                                    SOLO
                                </button>
                            </div>
                        ))}
                    </div>

                    {/* Result Visualization */}
                    <div className="bg-black p-4 text-center">
                        <div className="text-slate-500 text-xs mb-2">OUTPUT MIX</div>
                        <div className="h-16 flex items-center justify-center gap-1">
                            {/* Simple visualizer bars */}
                            {Array.from({ length: 20 }).map((_, i) => (
                                <div
                                    key={i}
                                    className={`w-1 rounded-full transition-all duration-100 ${isPlaying ? 'bg-yellow-500' : 'bg-slate-800'}`}
                                    style={{
                                        height: isPlaying ? `${Math.random() * 100}%` : '4px',
                                        opacity: isPlaying ? 1 : 0.3
                                    }}
                                ></div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            return (
                <div className="min-h-screen bg-slate-950 pb-12 font-sans selection:bg-purple-500 selection:text-white">
                    {/* Navigation */}
                    <div className="bg-slate-950/80 border-b border-slate-800/50 sticky top-0 z-50 backdrop-blur-md">
                        <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                            <a href="index2.html" className="inline-flex items-center text-slate-400 hover:text-white font-bold transition-colors text-sm">
                                <ArrowLeft className="mr-2 w-4 h-4" />
                                回總整理
                            </a>
                            <div className="text-xs font-mono text-slate-500">Audio Channels</div>
                        </div>
                    </div>

                    <main className="max-w-5xl mx-auto px-4 pt-12">
                        {/* Title */}
                        <header className="mb-16 text-center">
                            <h1 className="text-3xl md:text-5xl font-black mb-4 text-white">
                                聲道設定與 PolyWAV
                            </h1>
                            <p className="text-slate-400 text-lg">
                                Mastering Mono, Stereo, and Polyphonic Files
                            </p>
                        </header>

                        {/* Section 1: Mono vs Stereo */}
                        <section className="mb-20 grid md:grid-cols-12 gap-12">
                            <div className="md:col-span-12 space-y-6">
                                <div className="flex items-center justify-center gap-4 mb-4">
                                    <span className="inline-block px-3 py-1 bg-blue-900/50 text-blue-300 text-xs font-bold rounded-full border border-blue-700/50">
                                        PART 1: CHANNEL SETTINGS
                                    </span>
                                </div>
                                <div className="text-center max-w-3xl mx-auto mb-12">
                                    <h2 className="text-3xl font-bold text-white mb-4">來源與混音 (Source vs Output)</h2>
                                    <p className="text-slate-400 leading-relaxed text-lg">
                                        錄音時我們將單一麥克風視為「素材」(Source)。<br />
                                        這些素材若錯誤地混音為 Stereo，會導致聲音偏左或偏右。<br />
                                        正確的做法是在混音階段，將兩個音源當作mono素材，並將其置中。
                                    </p>
                                </div>
                                <MonoStereoDemo />
                            </div>
                        </section>

                        <div className="w-full h-px bg-slate-800 my-16"></div>

                        {/* Section 2: PolyWAV */}
                        <section className="grid md:grid-cols-12 gap-12">
                            <div className="md:col-span-5 space-y-6 md:order-2">
                                <span className="inline-block px-3 py-1 bg-yellow-900/50 text-yellow-300 text-xs font-bold rounded-full border border-yellow-700/50">
                                    PART 2: POLYWAV
                                </span>
                                <h2 className="text-3xl font-bold text-white">什麼是 PolyWAV？</h2>
                                <p className="text-slate-400 leading-relaxed text-lg">
                                    現代專業錄音機錄製的是 <strong className="text-white">PolyWAV</strong> 格式 —— 這是一種「包含多個音軌」的單一檔案。
                                </p>
                                <p className="text-slate-400 leading-relaxed">
                                    檔案給後期時只有一個 `.wav`，但丟進剪輯軟體 (Premiere/ProTools) 後，卻能展開成多個獨立的麥克風軌道 (ISO Tracks)。
                                </p>
                                <p className="text-slate-400 leading-relaxed">
                                    試著使用播放器，<strong>SOLO</strong> 不同軌道，聽聽看它們分別錄到了什麼聲音，這些素材將在後期製作時派上用場。
                                </p>
                            </div>
                            <div className="md:col-span-7 md:order-1">
                                <PolyWavDemo />
                            </div>
                        </section>

                    </main>

                    {/* Footer */}
                    <footer className="mt-24 border-t border-slate-800 py-12 text-center">
                        <p className="text-slate-600 text-sm">
                            義守大學電影與電視學系陳嘉暐老師課程提供
                        </p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>